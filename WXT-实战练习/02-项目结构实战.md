# WXT 实战练习 02: 项目结构与资源管理

## 练习目标

通过本练习,你将:
- 深入理解 WXT 项目结构
- 掌握 assets 和 public 的区别
- 学会使用路径别名
- 理解入口点命名规则

## 练习 2.1: 探索项目结构

### 任务

创建标准的 WXT 项目结构。

### 步骤

创建以下目录和文件:

```
my-extension/
├── entrypoints/           # 入口点目录
│   ├── background.ts      # 后台脚本
│   ├── content.ts         # 内容脚本
│   └── popup/             # Popup 页面
│       ├── index.html
│       ├── main.tsx
│       └── App.tsx
├── components/            # 共享组件
│   └── Button.tsx
├── hooks/                 # 自定义 Hooks
│   └── useStorage.ts
├── utils/                 # 工具函数
│   └── helpers.ts
├── assets/                # 需要处理的资源
│   └── images/
│       └── logo.svg
├── public/                # 静态资源
│   ├── icon/
│   │   ├── 16.png
│   │   ├── 32.png
│   │   ├── 48.png
│   │   └── 128.png
│   └── _locales/
│       └── en/
│           └── messages.json
├── wxt.config.ts
├── tsconfig.json
└── package.json
```

### 验证

运行开发服务器,确认没有错误:
```bash
pnpm dev
```

---

## 练习 2.2: assets vs public 对比

### 任务

理解 assets 和 public 目录的区别。

### 步骤

1. 在 `assets/images/` 放入一个 SVG 图片 (logo.svg)

2. 在 `public/images/` 放入一个 PNG 图片 (banner.png)

3. 在组件中分别使用:

```tsx
// components/ImageDemo.tsx
import logoSvg from '~/assets/images/logo.svg';
import bannerUrl from '/images/banner.png';

export function ImageDemo() {
  return (
    <div>
      <h3>Assets 图片 (经过 Vite 处理)</h3>
      <img src={logoSvg} alt="Logo" />
      <p>路径: {logoSvg}</p>
      
      <h3>Public 图片 (原样复制)</h3>
      <img src={bannerUrl} alt="Banner" />
      <p>路径: {bannerUrl}</p>
    </div>
  );
}
```

4. 构建项目并检查输出:

```bash
pnpm build
ls -la .output/chrome-mv3/assets/
```

### 观察

- assets 目录的文件名会包含哈希值 (如 `logo-abc123.svg`)
- public 目录的文件保持原名 (如 `banner.png`)

### 验证

- [ ] assets 图片显示正确
- [ ] public 图片显示正确
- [ ] 构建后文件名符合预期

---

## 练习 2.3: 路径别名使用

### 任务

配置和使用自定义路径别名。

### 步骤

1. 查看默认别名 (在 `.wxt/tsconfig.json`):
   - `~/*` -> `./`
   - `@/*` -> `./`

2. 创建工具函数:

```typescript
// utils/format.ts
export function formatDate(date: Date): string {
  return date.toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

export function formatNumber(num: number): string {
  return num.toLocaleString('zh-CN');
}
```

3. 在其他文件中使用别名导入:

```typescript
// entrypoints/popup/App.tsx
import { formatDate, formatNumber } from '~/utils/format';

function App() {
  return (
    <div>
      <p>日期: {formatDate(new Date())}</p>
      <p>数字: {formatNumber(1234567)}</p>
    </div>
  );
}
```

### 验证

- [ ] 别名导入正常工作
- [ ] TypeScript 类型提示正确
- [ ] 构建无错误

---

## 练习 2.4: 入口点命名规则

### 任务

创建各种类型的入口点,理解命名规则。

### 步骤

1. 创建基础入口点:

```
entrypoints/
├── background.ts          # 后台脚本
├── content.ts             # 默认内容脚本
├── popup/index.html       # Popup 页面
└── options.html           # 选项页面
```

2. 创建多个内容脚本:

```
entrypoints/
├── content.ts             # 所有页面
├── content.github.ts      # 命名为 github 的内容脚本
├── content.youtube.ts     # 命名为 youtube 的内容脚本
└── overlay.content.ts     # 命名为 overlay 的内容脚本
```

3. 实现内容脚本:

```typescript
// entrypoints/content.github.ts
export default defineContentScript({
  matches: ['*://*.github.com/*'],
  main() {
    console.log('GitHub content script loaded');
    document.body.style.border = '3px solid green';
  },
});
```

```typescript
// entrypoints/content.youtube.ts
export default defineContentScript({
  matches: ['*://*.youtube.com/*'],
  main() {
    console.log('YouTube content script loaded');
    document.body.style.border = '3px solid red';
  },
});
```

### 验证

- [ ] 访问 GitHub 时边框变绿
- [ ] 访问 YouTube 时边框变红
- [ ] 其他网站无边框变化

---

## 练习 2.5: 使用 srcDir 配置

### 任务

将源代码移到 `src` 目录。

### 步骤

1. 修改 `wxt.config.ts`:

```typescript
export default defineConfig({
  srcDir: 'src',
  modules: ['@wxt-dev/module-react'],
});
```

2. 重新组织项目结构:

```
my-extension/
├── src/
│   ├── entrypoints/
│   │   ├── background.ts
│   │   ├── content.ts
│   │   └── popup/
│   ├── components/
│   ├── hooks/
│   ├── utils/
│   └── assets/
├── public/
├── wxt.config.ts
└── package.json
```

3. 运行 `pnpm wxt prepare` 更新类型定义

4. 更新导入路径 (别名仍然有效):

```typescript
// src/entrypoints/popup/App.tsx
import { Button } from '~/components/Button';
import { formatDate } from '~/utils/format';
```

### 验证

- [ ] 项目正常构建
- [ ] 别名指向正确的 src 目录
- [ ] TypeScript 无报错

---

## 练习 2.6: 输出目录模板

### 任务

自定义构建输出目录名称。

### 步骤

1. 修改 `wxt.config.ts`:

```typescript
export default defineConfig({
  // 自定义输出目录模板
  outDirTemplate: '{{browser}}-{{manifestVersion}}-{{mode}}',
});
```

2. 构建项目:

```bash
# 开发构建
pnpm build

# 生产构建
pnpm build --mode production
```

3. 查看输出:

```bash
ls -la .output/
# chrome-mv3-development/
# chrome-mv3-production/
```

### 模板变量

| 变量 | 说明 | 示例 |
|------|------|------|
| `{{browser}}` | 浏览器名称 | chrome, firefox |
| `{{manifestVersion}}` | manifest 版本 | mv2, mv3 |
| `{{mode}}` | 构建模式 | development, production |

### 验证

- [ ] 输出目录名称符合预期
- [ ] 不同构建不会相互覆盖

---

## 挑战练习

### 挑战 1: 创建共享类型

创建共享类型定义文件:

```typescript
// types/index.ts
export interface Message {
  type: string;
  payload?: unknown;
}

export interface Settings {
  theme: 'light' | 'dark';
  language: string;
  notifications: boolean;
}

export interface TabInfo {
  id: number;
  url: string;
  title: string;
}
```

在多个入口点中使用:

```typescript
// entrypoints/background.ts
import type { Message, Settings } from '~/types';

// entrypoints/popup/App.tsx
import type { Settings } from '~/types';
```

### 挑战 2: 组织 CSS 文件

创建 CSS 模块结构:

```
src/
├── styles/
│   ├── globals.css       # 全局样式
│   ├── variables.css     # CSS 变量
│   └── components/
│       ├── Button.module.css
│       └── Card.module.css
```

在组件中使用:

```tsx
// components/Button.tsx
import styles from '~/styles/components/Button.module.css';

export function Button({ children }: { children: React.ReactNode }) {
  return (
    <button className={styles.button}>
      {children}
    </button>
  );
}
```

---

## 自我检查

完成本练习后,你应该能够回答:

1. assets 和 public 目录有什么区别?
2. 如何创建多个内容脚本?
3. `~` 和 `@` 路径别名指向哪里?
4. srcDir 配置有什么作用?
5. 入口点文件必须放在什么目录?

## 参考答案

1. assets 会被 Vite 处理 (压缩、哈希),public 原样复制
2. 使用命名约定: `content.name.ts` 或 `name.content.ts`
3. 都指向 srcDir (默认是项目根目录)
4. 指定源代码目录,可以将代码组织到 src/ 下
5. entrypoints/ 目录
