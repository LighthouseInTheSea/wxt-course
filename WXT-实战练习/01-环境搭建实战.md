# WXT 实战练习 01: 环境搭建与首个扩展

## 练习目标

通过本练习,你将:
- 搭建 WXT 开发环境
- 创建第一个浏览器扩展
- 理解项目配置文件
- 掌握开发调试流程

## 练习 1.1: 创建项目

### 任务

创建一个名为 `my-first-extension` 的 WXT 项目。

### 步骤

```bash
# 1. 创建项目
pnpm dlx wxt@latest init my-first-extension

# 选择配置:
# - Template: react
# - Package Manager: pnpm
# - Install dependencies: Yes

# 2. 进入项目
cd my-first-extension

# 3. 启动开发服务器
pnpm dev
```

### 验证

- [ ] Chrome 浏览器自动打开
- [ ] 扩展已加载 (地址栏右侧出现图标)
- [ ] 点击图标出现 Popup 页面

---

## 练习 1.2: 修改扩展信息

### 任务

修改 `wxt.config.ts`,自定义扩展的名称、版本和描述。

### 步骤

```typescript
// wxt.config.ts
import { defineConfig } from 'wxt';

export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  manifest: {
    name: '我的第一个扩展',
    version: '0.1.0',
    description: '这是我用 WXT 创建的第一个浏览器扩展',
    
    // 添加作者信息
    author: '你的名字',
  },
});
```

### 验证

1. 保存文件后,开发服务器自动重新加载
2. 打开 `chrome://extensions/`
3. 找到你的扩展,确认名称和描述已更新

---

## 练习 1.3: 添加扩展图标

### 任务

为扩展添加自定义图标。

### 步骤

1. 准备图标文件 (16x16, 32x32, 48x48, 128x128 像素)

2. 创建目录结构:
```
public/
└── icon/
    ├── 16.png
    ├── 32.png
    ├── 48.png
    └── 128.png
```

3. 如果没有图标,可以使用在线工具生成,或创建简单的纯色图标

4. WXT 会自动识别 `public/icon/` 目录下的图标

### 验证

- [ ] 扩展图标在工具栏显示正确
- [ ] `chrome://extensions/` 页面显示正确图标

---

## 练习 1.4: 多浏览器构建

### 任务

分别为 Chrome 和 Firefox 构建扩展。

### 步骤

```bash
# 为 Chrome 构建 (MV3)
pnpm build

# 为 Firefox 构建 (MV2)
pnpm build:firefox

# 查看输出目录
ls -la .output/
```

### 验证

检查 `.output/` 目录:
- [ ] `chrome-mv3/` 目录存在
- [ ] `firefox-mv2/` 目录存在
- [ ] 每个目录都包含 `manifest.json`

比较两个 manifest.json 的区别:
```bash
# 查看 Chrome manifest
cat .output/chrome-mv3/manifest.json

# 查看 Firefox manifest  
cat .output/firefox-mv2/manifest.json
```

---

## 练习 1.5: 配置 TypeScript

### 任务

熟悉项目的 TypeScript 配置。

### 步骤

1. 查看 `tsconfig.json`:

```json
{
  "extends": "./.wxt/tsconfig.json"
}
```

2. 运行 `pnpm wxt prepare` 生成类型定义

3. 查看生成的类型文件:
```bash
ls -la .wxt/
cat .wxt/tsconfig.json
```

### 练习题

在 `entrypoints/popup/App.tsx` 中添加一个带类型的组件:

```tsx
// 定义 Props 类型
interface GreetingProps {
  name: string;
  count?: number;
}

// 创建组件
function Greeting({ name, count = 0 }: GreetingProps) {
  return (
    <div>
      <h2>Hello, {name}!</h2>
      <p>Visited {count} times</p>
    </div>
  );
}

// 在 App 组件中使用
function App() {
  return (
    <div>
      <Greeting name="WXT Developer" count={5} />
    </div>
  );
}
```

### 验证

- [ ] TypeScript 没有报错
- [ ] Popup 页面正确显示组件内容

---

## 练习 1.6: 环境变量

### 任务

使用环境变量配置扩展。

### 步骤

1. 创建 `.env` 文件:

```env
# .env
WXT_APP_NAME=My Extension
WXT_API_URL=https://api.example.com
```

2. 创建 `.env.development` 文件:

```env
# .env.development
WXT_DEBUG=true
WXT_API_URL=http://localhost:3000
```

3. 在代码中使用:

```typescript
// entrypoints/popup/App.tsx
function App() {
  return (
    <div>
      <p>App: {import.meta.env.WXT_APP_NAME}</p>
      <p>API: {import.meta.env.WXT_API_URL}</p>
      <p>Debug: {String(import.meta.env.WXT_DEBUG)}</p>
      <p>Mode: {import.meta.env.MODE}</p>
    </div>
  );
}
```

### 验证

- [ ] 开发模式显示 localhost API URL
- [ ] 生产构建使用正式 API URL

---

## 挑战练习

### 挑战 1: 自定义构建命令

在 `package.json` 中添加以下脚本:

```json
{
  "scripts": {
    "dev": "wxt",
    "dev:firefox": "wxt -b firefox",
    "build": "wxt build",
    "build:firefox": "wxt build -b firefox",
    "build:all": "wxt build && wxt build -b firefox",
    "zip": "wxt zip",
    "zip:all": "wxt zip && wxt zip -b firefox",
    "prepare": "wxt prepare",
    "clean": "rimraf .output .wxt"
  }
}
```

### 挑战 2: 添加构建时间戳

修改 `wxt.config.ts`,在构建时注入版本信息:

```typescript
import { defineConfig } from 'wxt';

export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  
  vite: () => ({
    define: {
      __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
      __GIT_COMMIT__: JSON.stringify(
        process.env.GIT_COMMIT || 'development'
      ),
    },
  }),
});
```

在代码中使用:

```typescript
declare const __BUILD_TIME__: string;
declare const __GIT_COMMIT__: string;

console.log('Build time:', __BUILD_TIME__);
console.log('Git commit:', __GIT_COMMIT__);
```

---

## 自我检查

完成本练习后,你应该能够回答:

1. WXT 项目的入口配置文件是什么?
2. 如何为不同浏览器构建扩展?
3. TypeScript 类型定义存放在哪里?
4. 环境变量前缀必须是什么?
5. 开发服务器的默认浏览器是什么?

## 参考答案

1. `wxt.config.ts`
2. 使用 `-b` 参数: `wxt build -b firefox`
3. `.wxt/` 目录
4. `WXT_` (只有此前缀的变量会被暴露到客户端)
5. Chrome
