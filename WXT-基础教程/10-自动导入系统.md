# WXT 自动导入系统

## 1. 自动导入概述

WXT 基于 `unimport` 包提供了强大的自动导入功能,可以自动导入常用的 API 和函数,无需手动编写 import 语句。

### 1.1 默认自动导入的内容

WXT 默认自动导入以下内容:

```typescript
// 这些都可以直接使用,无需 import
defineBackground()
defineContentScript()
defineUnlistedScript()
createShadowRootUi()
createIntegratedUi()
createIframeUi()
ContentScriptContext
MatchPattern
browser  // 浏览器扩展 API
storage  // WXT Storage API
```

## 2. 配置自动导入

### 2.1 基础配置

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    // 添加自定义预设
    presets: [
      'react',  // 自动导入 React hooks
    ],
    // 添加自定义导入
    imports: [
      { name: 'clsx', from: 'clsx' },
      { name: 'default', as: 'axios', from: 'axios' },
    ],
  },
});
```

### 2.2 禁用自动导入

如果你更喜欢显式导入,可以完全禁用自动导入:

```typescript
// wxt.config.ts
export default defineConfig({
  imports: false,
});
```

### 2.3 手动导入 WXT API

禁用自动导入后,需要手动从 `#imports` 导入:

```typescript
import {
  defineBackground,
  defineContentScript,
  createShadowRootUi,
  ContentScriptContext,
  MatchPattern,
} from '#imports';
```

## 3. ESLint 集成

自动导入的变量可能导致 ESLint 报告 "undefined variable" 错误。WXT 提供了自动生成 ESLint 配置的功能。

### 3.1 ESLint 9 配置

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    eslintrc: {
      enabled: 9,  // 生成 ESLint 9 兼容配置
    },
  },
});
```

使用生成的配置:

```javascript
// eslint.config.mjs
import autoImports from './.wxt/eslint-auto-imports.mjs';

export default [
  autoImports,
  {
    // 其他 ESLint 配置...
    rules: {
      // 自定义规则
    },
  },
];
```

### 3.2 ESLint 8 配置

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    eslintrc: {
      enabled: 8,  // 生成 ESLint 8 兼容配置
    },
  },
});
```

使用生成的配置:

```javascript
// .eslintrc.mjs
export default {
  extends: ['./.wxt/eslintrc-auto-import.json'],
  // 其他配置...
};
```

## 4. TypeScript 支持

### 4.1 配置 postinstall 脚本

为确保 TypeScript 和编辑器正确识别自动导入的变量:

```json
{
  "scripts": {
    "postinstall": "wxt prepare"
  }
}
```

### 4.2 生成的类型文件

运行 `wxt prepare` 后,WXT 会在 `.wxt/types/` 目录生成类型定义:

```
.wxt/
├── types/
│   ├── imports.d.ts      # 自动导入类型
│   └── imports-global.d.ts
└── tsconfig.json
```

## 5. 添加自定义导入预设

### 5.1 添加第三方库预设

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    presets: [
      // React 相关
      'react',
      
      // 状态管理
      {
        from: 'zustand',
        imports: ['create', 'createStore'],
      },
      
      // 工具库
      {
        from: 'lodash-es',
        imports: ['debounce', 'throttle', 'cloneDeep'],
      },
    ],
  },
});
```

### 5.2 从项目目录自动导入

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    dirs: [
      './src/composables/**',  // 自动导入 composables
      './src/utils/**',        // 自动导入 utils
    ],
  },
});
```

## 6. 实战示例

### 6.1 React 项目配置

```typescript
// wxt.config.ts
export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  imports: {
    presets: ['react'],
    eslintrc: {
      enabled: 9,
    },
    imports: [
      // 添加常用库
      { name: 'clsx', from: 'clsx' },
      { name: 'cn', from: '@/lib/utils' },
    ],
  },
});
```

### 6.2 使用自动导入

```tsx
// entrypoints/popup/App.tsx
// useState, useEffect 自动从 'react' 导入
// browser, storage 自动从 WXT 导入
// clsx 自动导入

export default function App() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    // 直接使用 storage,无需导入
    storage.getItem('local:count').then((value) => {
      if (value) setCount(value);
    });
  }, []);
  
  const handleClick = async () => {
    const newCount = count + 1;
    setCount(newCount);
    await storage.setItem('local:count', newCount);
  };
  
  return (
    <button 
      className={clsx('btn', { 'btn-active': count > 0 })}
      onClick={handleClick}
    >
      Count: {count}
    </button>
  );
}
```

## 7. 调试自动导入

### 7.1 查看已导入内容

检查 `.wxt/types/imports.d.ts` 文件,查看所有自动导入的声明:

```typescript
// .wxt/types/imports.d.ts (自动生成)
export {}
declare global {
  const browser: typeof import('wxt/browser')['browser']
  const storage: typeof import('wxt/storage')['storage']
  const defineBackground: typeof import('wxt/sandbox')['defineBackground']
  const defineContentScript: typeof import('wxt/sandbox')['defineContentScript']
  // ...更多
}
```

### 7.2 常见问题

**问题: ESLint 报告未定义变量**
```bash
# 重新生成配置
pnpm wxt prepare
```

**问题: TypeScript 不识别自动导入**
```bash
# 确保 tsconfig.json 正确继承
{
  "extends": "./.wxt/tsconfig.json"
}
```

## 8. 最佳实践

### 8.1 推荐配置

```typescript
// wxt.config.ts
export default defineConfig({
  imports: {
    // 启用 ESLint 集成
    eslintrc: {
      enabled: 9,
    },
    // 添加常用预设
    presets: ['react'],
    // 项目级自动导入
    dirs: ['./src/hooks', './src/utils'],
  },
});
```

### 8.2 何时使用显式导入

虽然自动导入很方便,但以下情况建议使用显式导入:

1. **类型导入**: 复杂类型最好显式导入以提高可读性
2. **大型库**: 避免自动导入整个大型库
3. **团队协作**: 新成员可能不熟悉自动导入的内容

```typescript
// 推荐: 类型显式导入
import type { Browser } from 'wxt/browser';

function handleMessage(sender: Browser.runtime.MessageSender) {
  // ...
}
```

## 9. 小结

| 功能 | 配置项 | 说明 |
|------|--------|------|
| 禁用 | `imports: false` | 完全禁用自动导入 |
| 预设 | `imports.presets` | 添加预定义导入集 |
| 自定义 | `imports.imports` | 添加单个导入 |
| 目录 | `imports.dirs` | 从目录自动导入 |
| ESLint | `imports.eslintrc` | 生成 ESLint 配置 |
